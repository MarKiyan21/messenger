<!DOCTYPE html>
{% load static %}

<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Floctopus.com</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel='shortcut icon' type='image/x-icon' href="{% static "img/favicon.ico" %}" />
        <link rel="stylesheet" href="{% static "style.css" %}" type="text/css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    </head>
    
    <body>
        <script
            src="http://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous">
        </script>
        
        <script>
                $(document).ready(function() {
                    $.get("http://localhost:8000/getUsers/");
                });
        </script>

        <div class="modal-content" id="chat">
            <div class="head-chat">
                <button class="close" type="button" data-dismiss="modal" aria-hidden="true">
                    <img src="{% static "img/close-button.png" %}">
                </button>
            </div>
        
            <div class="left-chat">
                    <button type="button" class="btn-sound-off">
                        <img src="{% static "img/speaker-on.png" %}">
                    </button>
                    <button type="button" class="btn-sound-on">
                        <img src="{% static "img/speaker-off.png" %}">
                    </button>
                    <button type="button" class="pull-right">
                        <img src="{% static "img/create-group-button.png" %}">
                    </button>
            </div>

            <div class="chat-input">
                <form class="form-horizontal">
                    <div class="col-sm-1" id="clip">
                        <button type="button" aria-hidden="true" id="chAttach" class="btn-chat-serach">
                            <img src="{% static "img/clip.png" %}">
                        </button>
                    </div>	
                    
                    <div class="col-sm-10 ch-in-wrapper" id="input-text">
                        <input class="form-control ch-in" name="m" id="chat-m" placeholder="Your message here....">
                        </input>
                    </div>
                        
                    <div class="col-sm-1" id="send">
                        <button id="button" type="button" class="btn btn-primary">
                            <img src="{% static "img/right-arrow.png" %}">
                        </button>
                    </div>	
                </form>	
            </div>
        </div>

        <script>
            
            var channel = "private-5a65a1d874a8d";
            var uch = "private-5a65b573d5e5b";
            var socket = new WebSocket("ws://localhost:8000/" + uch);

            socket.onopen = function (event) {
                console.log(socket)
                $("#button").on("click", function(e) {
                    var message = $("#chat-m").val();
                    var data = {
                        msg: message,
                        channel: channel,
                        uch: uch,
                    };
                    socket.send(JSON.stringify(data));
                });
                socket.onmessage = function (event) {
                    alert(event.data);
                }
            };

            socket.onerror = function (event) {
                console.log(event)
            }

            socket.onclose = function (event) {
                console.log(event)
            }
        </script>
    </body>
</html>